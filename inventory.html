<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Inventory and stock management dashboard with CRUD capabilities and local storage persistence">
    <meta name="author" content="Inventory App">

    <title>Inventory Management System</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" type="text/css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8f9fc;
        }

        #wrapper {
            display: flex;
            min-height: 100vh;
        }

        #content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar {
            width: 224px;
            min-height: 100vh;
            background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);
        }

        .sidebar .nav-item .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
        }

        .sidebar .nav-item .nav-link:hover,
        .sidebar .nav-item .nav-link.active {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.15);
        }

        .sidebar-brand {
            height: 4.375rem;
            text-decoration: none;
            color: #fff;
            font-weight: 700;
            padding: 1.5rem 1rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-divider {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 1rem;
        }

        .sidebar-heading {
            padding: 0 1rem;
            font-size: 0.65rem;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            margin: 0;
            padding-top: 0.75rem;
            padding-bottom: 0.5rem;
        }

        .topbar {
            height: 4.375rem;
            background-color: #fff;
            border-bottom: 1px solid #e3e6f0;
            display: flex;
            align-items: center;
            padding: 0 1rem;
        }

        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }

        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }

        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }

        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }

        .card {
            border: 0;
            border-radius: 0.75rem;
        }

        .card-header {
            background-color: #fff;
            border-bottom: 0;
        }

        .badge-category {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }

        .low-stock {
            background-color: #fff3cd !important;
        }

        .out-of-stock {
            background-color: #f8d7da !important;
        }

        .table thead th {
            background-color: #f8f9fc;
            border-bottom: 2px solid #dee2e6;
        }

        .table tbody td {
            vertical-align: middle;
        }

        .sticky-footer {
            background-color: #fff;
            padding: 1rem 0;
            margin-top: auto;
        }

        #alertContainer {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1050;
        }

        @media (max-width: 991.98px) {
            .sidebar {
                position: fixed;
                left: -224px;
                transition: left 0.3s ease;
                z-index: 1040;
            }

            .sidebar.show {
                left: 0;
            }

            body.sidebar-open {
                overflow: hidden;
            }
        }

        @media (max-width: 767.98px) {
            .topbar .navbar-search {
                display: none !important;
            }

            .card-header-flex {
                flex-direction: column;
                align-items: flex-start;
            }

            .card-header-flex .input-group {
                width: 100%;
                margin-top: 1rem;
            }
        }
    </style>
</head>

<body id="page-top">

    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar">
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="inventory.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Inventory</div>
            </a>

            <hr class="sidebar-divider my-0">

            <li class="nav-item" id="navAllItems">
                <a class="nav-link active" href="#" onclick="showAllItems(); return false;">
                    <i class="fas fa-fw fa-list"></i>
                    <span>All Items</span>
                </a>
            </li>

            <hr class="sidebar-divider">

            <div class="sidebar-heading">Insights</div>

            <li class="nav-item" id="navLowStock">
                <a class="nav-link" href="#" onclick="filterByLowStock(); return false;">
                    <i class="fas fa-fw fa-exclamation-triangle"></i>
                    <span>Low Stock</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showAddItemModal(); return false;">
                    <i class="fas fa-fw fa-plus"></i>
                    <span>Add New Item</span>
                </a>
            </li>

            <hr class="sidebar-divider d-none d-md-block">
        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="search" class="form-control bg-light border-0 small" placeholder="Search items..."
                                aria-label="Search" id="searchInput" oninput="searchItems()">
                            <div class="input-group-append">
                                <span class="btn btn-primary">
                                    <i class="fas fa-search fa-sm"></i>
                                </span>
                            </div>
                        </div>
                    </form>

                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Admin User</span>
                                <i class="fas fa-user-circle fa-2x"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>
                    </ul>
                </nav>
                <!-- End of Topbar -->

                <div class="container-fluid">

                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <div>
                            <h1 class="h3 mb-0 text-gray-800">Inventory Dashboard</h1>
                            <p class="text-muted mb-0">Manage stock levels, track categories, and maintain product data.</p>
                        </div>
                        <button class="btn btn-primary shadow-sm" onclick="showAddItemModal()">
                            <i class="fas fa-plus fa-sm text-white-50"></i> Add New Item
                        </button>
                    </div>

                    <div id="alertContainer"></div>

                    <div class="row">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Items</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalItems">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-boxes fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Inventory Value</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalValue">$0.00</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Categories</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalCategories">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-tags fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Low Stock Items</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="lowStockItems">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6 mb-2 mb-md-0">
                            <select class="form-control" id="categoryFilter" onchange="filterItems()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select class="form-control" id="sortBy" onchange="sortItems()">
                                <option value="name">Sort by Name (A-Z)</option>
                                <option value="quantity">Sort by Quantity (High-Low)</option>
                                <option value="price">Sort by Price (High-Low)</option>
                                <option value="sku">Sort by SKU (A-Z)</option>
                            </select>
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex align-items-center justify-content-between card-header-flex">
                            <div>
                                <h6 class="m-0 font-weight-bold text-primary">Inventory Items</h6>
                                <small class="text-muted">Showing <span id="visibleItemCount">0</span> item(s)</small>
                            </div>
                            <div class="input-group input-group-sm" style="max-width: 320px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text bg-light border-0"><i class="fas fa-search"></i></span>
                                </div>
                                <input type="search" class="form-control border-0" placeholder="Quick search..."
                                    oninput="searchItems()" id="quickSearchInput">
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover mb-0" id="inventoryTable">
                                    <thead>
                                        <tr>
                                            <th>SKU</th>
                                            <th>Item</th>
                                            <th>Category</th>
                                            <th class="text-center">Quantity</th>
                                            <th class="text-right">Price</th>
                                            <th class="text-right">Total Value</th>
                                            <th class="text-center" style="width: 120px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Main Content -->

            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="text-center my-auto text-muted small">
                        &copy; 2024 Inventory Management System
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="itemModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itemModalLabel">Add New Item</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId">
                        <div class="form-group">
                            <label for="itemSku">SKU *</label>
                            <input type="text" class="form-control" id="itemSku" required>
                        </div>
                        <div class="form-group">
                            <label for="itemName">Item Name *</label>
                            <input type="text" class="form-control" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label for="itemCategory">Category *</label>
                            <input type="text" class="form-control" id="itemCategory" required>
                        </div>
                        <div class="form-group">
                            <label for="itemQuantity">Quantity *</label>
                            <input type="number" class="form-control" id="itemQuantity" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="itemPrice">Price ($) *</label>
                            <input type="number" class="form-control" id="itemPrice" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="itemDescription">Description</label>
                            <textarea class="form-control" id="itemDescription" rows="3" placeholder="Optional details about the item"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" type="button" onclick="saveItem()">Save Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this item? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <button class="btn btn-danger" type="button" onclick="confirmDelete()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const STORAGE_KEY = 'inventoryData';
        const dummyData = [
            { id: 1, sku: 'LAP-001', name: 'Dell XPS 15 Laptop', category: 'Electronics', quantity: 25, price: 1299.99, description: 'High-performance laptop for professionals.' },
            { id: 2, sku: 'MOU-002', name: 'Logitech MX Master 3', category: 'Electronics', quantity: 8, price: 99.99, description: 'Wireless productivity mouse with ergonomic design.' },
            { id: 3, sku: 'KEY-003', name: 'RGB Mechanical Keyboard', category: 'Accessories', quantity: 15, price: 149.99, description: 'Customizable mechanical keyboard with RGB lighting.' },
            { id: 4, sku: 'CHR-004', name: 'Ergonomic Office Chair', category: 'Furniture', quantity: 12, price: 299.99, description: 'Adjustable mesh office chair with lumbar support.' },
            { id: 5, sku: 'DSK-005', name: 'Standing Desk 60"', category: 'Furniture', quantity: 5, price: 499.99, description: 'Electric height-adjustable standing desk.' },
            { id: 6, sku: 'MON-006', name: 'LG 27" 4K Monitor', category: 'Electronics', quantity: 18, price: 399.99, description: 'Ultra HD monitor with HDR support.' },
            { id: 7, sku: 'PRT-007', name: 'HP LaserJet Pro', category: 'Electronics', quantity: 3, price: 249.99, description: 'Compact black-and-white laser printer.' },
            { id: 8, sku: 'CAB-008', name: '6ft USB-C Cable', category: 'Accessories', quantity: 50, price: 14.99, description: 'Fast-charging braided USB-C cable.' },
            { id: 9, sku: 'BAG-009', name: 'Travel Laptop Backpack', category: 'Accessories', quantity: 22, price: 59.99, description: 'Water-resistant backpack with padded compartments.' },
            { id: 10, sku: 'HDP-010', name: 'Sony WH-1000XM5 Headphones', category: 'Electronics', quantity: 2, price: 349.99, description: 'Noise-cancelling over-ear headphones.' },
            { id: 11, sku: 'TAB-011', name: 'iPad Pro 12.9"', category: 'Electronics', quantity: 10, price: 1099.99, description: 'Latest generation tablet with M2 chip.' },
            { id: 12, sku: 'LMP-012', name: 'Adjustable LED Desk Lamp', category: 'Furniture', quantity: 30, price: 39.99, description: 'Touch-control LED lamp with USB charging port.' }
        ];

        let inventory = [];
        let deleteItemId = null;
        const state = {
            searchTerm: '',
            category: '',
            view: 'all',
            sortBy: 'name'
        };

        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            loadInventory();
            if (!inventory.length) {
                inventory = dummyData.map(item => ({ ...item }));
                saveInventory();
            }

            updateDashboard();
            populateCategoryFilter();
            applyStateAndRender();

            document.getElementById('sidebarToggleTop').addEventListener('click', () => {
                document.getElementById('accordionSidebar').classList.toggle('show');
                document.body.classList.toggle('sidebar-open');
            });
        }

        function loadInventory() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    if (Array.isArray(parsed)) {
                        inventory = parsed.map(normalizeItem);
                    }
                } catch (error) {
                    console.warn('Failed to parse inventory data, loading defaults.', error);
                    inventory = [];
                }
            }
        }

        function normalizeItem(item) {
            return {
                id: Number(item.id),
                sku: String(item.sku || '').trim(),
                name: String(item.name || '').trim(),
                category: String(item.category || '').trim(),
                quantity: Number(item.quantity) || 0,
                price: Number(item.price) || 0,
                description: String(item.description || '').trim()
            };
        }

        function saveInventory() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(inventory));
        }

        function applyStateAndRender() {
            let items = inventory.map(item => ({ ...item }));

            if (state.searchTerm) {
                const query = state.searchTerm.toLowerCase();
                items = items.filter(item =>
                    item.name.toLowerCase().includes(query) ||
                    item.sku.toLowerCase().includes(query) ||
                    item.category.toLowerCase().includes(query)
                );
            }

            if (state.category) {
                items = items.filter(item => item.category === state.category);
            }

            if (state.view === 'lowStock') {
                items = items.filter(item => item.quantity <= 5);
            }

            items = sortCollection(items);
            renderInventory(items);
        }

        function sortCollection(items) {
            const sorted = [...items];
            switch (state.sortBy) {
                case 'quantity':
                    return sorted.sort((a, b) => b.quantity - a.quantity);
                case 'price':
                    return sorted.sort((a, b) => b.price - a.price);
                case 'sku':
                    return sorted.sort((a, b) => a.sku.localeCompare(b.sku));
                default:
                    return sorted.sort((a, b) => a.name.localeCompare(b.name));
            }
        }

        function renderInventory(items) {
            const tbody = document.getElementById('inventoryTableBody');
            tbody.innerHTML = '';

            document.getElementById('visibleItemCount').textContent = items.length;

            if (!items.length) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = '<td colspan="7" class="text-center text-muted py-4">No inventory items match your criteria.</td>';
                tbody.appendChild(emptyRow);
                return;
            }

            items.forEach(item => {
                const row = document.createElement('tr');
                if (item.quantity === 0) {
                    row.classList.add('out-of-stock');
                } else if (item.quantity <= 5) {
                    row.classList.add('low-stock');
                }

                const totalValue = item.quantity * item.price;

                row.innerHTML = `
                    <td class="font-weight-bold">${item.sku}</td>
                    <td>
                        <div class="font-weight-bold text-gray-800">${item.name}</div>
                        <small class="text-muted d-block">${item.description || 'No description provided.'}</small>
                    </td>
                    <td><span class="badge badge-info badge-category">${item.category || 'Uncategorized'}</span></td>
                    <td class="text-center">${item.quantity}</td>
                    <td class="text-right">${formatCurrency(item.price)}</td>
                    <td class="text-right">${formatCurrency(totalValue)}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-primary mr-2" title="Edit" onclick="editItem(${item.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteItem(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function formatCurrency(value) {
            return `$${Number(value).toFixed(2)}`;
        }

        function updateDashboard() {
            const totalItems = inventory.length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const categories = new Set(inventory.map(item => item.category).filter(Boolean));
            const lowStockItems = inventory.filter(item => item.quantity <= 5 && item.quantity > 0).length;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('totalCategories').textContent = categories.size;
            document.getElementById('lowStockItems').textContent = lowStockItems;
        }

        function populateCategoryFilter() {
            const select = document.getElementById('categoryFilter');
            const categories = Array.from(new Set(inventory.map(item => item.category).filter(Boolean))).sort((a, b) => a.localeCompare(b));

            select.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });

            select.value = state.category;
        }

        function showAddItemModal() {
            document.getElementById('itemModalLabel').textContent = 'Add New Item';
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            $('#itemModal').modal('show');
        }

        function editItem(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            document.getElementById('itemModalLabel').textContent = 'Edit Item';
            document.getElementById('itemId').value = item.id;
            document.getElementById('itemSku').value = item.sku;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemQuantity').value = item.quantity;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemDescription').value = item.description || '';

            $('#itemModal').modal('show');
        }

        function saveItem() {
            const form = document.getElementById('itemForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const id = document.getElementById('itemId').value;
            const payload = normalizeItem({
                id: id ? Number(id) : undefined,
                sku: document.getElementById('itemSku').value,
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                quantity: document.getElementById('itemQuantity').value,
                price: document.getElementById('itemPrice').value,
                description: document.getElementById('itemDescription').value
            });

            if (id) {
                const index = inventory.findIndex(i => i.id === payload.id);
                if (index !== -1) {
                    inventory[index] = { ...inventory[index], ...payload };
                    showAlert('Item updated successfully.', 'success');
                }
            } else {
                const newId = inventory.length ? Math.max(...inventory.map(item => item.id)) + 1 : 1;
                inventory.push({ ...payload, id: newId });
                showAlert('Item added to inventory.', 'success');
            }

            saveInventory();
            updateDashboard();
            populateCategoryFilter();
            applyStateAndRender();
            $('#itemModal').modal('hide');
        }

        function deleteItem(id) {
            deleteItemId = id;
            $('#deleteModal').modal('show');
        }

        function confirmDelete() {
            if (deleteItemId === null) return;
            inventory = inventory.filter(item => item.id !== deleteItemId);
            saveInventory();
            updateDashboard();
            populateCategoryFilter();
            applyStateAndRender();
            showAlert('Item removed from inventory.', 'danger');
            $('#deleteModal').modal('hide');
            deleteItemId = null;
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show shadow`; 
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            `;
            container.appendChild(alert);
            setTimeout(() => {
                $(alert).alert('close');
            }, 3500);
        }

        function searchItems() {
            state.searchTerm = document.getElementById('searchInput').value.trim() || document.getElementById('quickSearchInput').value.trim();
            state.searchTerm = state.searchTerm.toLowerCase();
            applyStateAndRender();
        }

        function filterItems() {
            state.category = document.getElementById('categoryFilter').value;
            state.view = 'all';
            setActiveSidebar('all');
            applyStateAndRender();
        }

        function filterByLowStock() {
            state.view = 'lowStock';
            state.category = '';
            document.getElementById('categoryFilter').value = '';
            setActiveSidebar('low');
            applyStateAndRender();
        }

        function showAllItems() {
            state.view = 'all';
            state.category = '';
            state.searchTerm = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('quickSearchInput').value = '';
            setActiveSidebar('all');
            applyStateAndRender();
        }

        function sortItems() {
            state.sortBy = document.getElementById('sortBy').value;
            applyStateAndRender();
        }

        function setActiveSidebar(type) {
            const allLink = document.querySelector('#navAllItems .nav-link');
            const lowLink = document.querySelector('#navLowStock .nav-link');
            if (type === 'low') {
                allLink.classList.remove('active');
                lowLink.classList.add('active');
            } else {
                lowLink.classList.remove('active');
                allLink.classList.add('active');
            }
        }
    </script>

</body>

</html>
